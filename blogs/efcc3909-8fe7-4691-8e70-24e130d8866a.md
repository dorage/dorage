---
uuid: efcc3909-8fe7-4691-8e70-24e130d8866a
description: 
title: [íšŒê³ ] ë” ë‚˜ì€ ì„œë¹„ìŠ¤ë¥¼ ìœ„í•´ - API ì •ë¦¬
tags: [  ]
date: 2023-04-22T15:00:00.000Z
---








ê¸°ì¡´ í”„ë¡œì íŠ¸ëŠ” ë„¤íŠ¸ì›Œí¬ íŒ¨ì¹­ì„ ìœ„í•´ Axiosì™€ ìƒíƒœê´€ë¦¬ë¥¼ ìœ„í•œ React-Queryë¥¼ ì‚¬ìš©í•˜ê³  ìˆì—ˆë‹¤.

## ë¬¸ì œì 

### í˜¼ì¬ëœ ì½”ë“œ

ê¸°ì¡´ ë°©ì‹ì€ api íŒŒì¼ì˜ ìµœìƒìœ„ pathnameì„ ê°€ì§„ íŒŒì¼ì— react-query hookì„ í˜¸ì¶œí•´ì„œ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ì™€ apië¥¼ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜ê°€ ì¼ì •í•œ ìˆœì„œì„±ì´ë‚˜ ì ì ˆí•œ ì£¼ì„ì—†ì´ í˜¼ì¬í•´ì„œ ì‘ì„±ë˜ì–´ ìˆì—ˆë‹¤.

ì´ë ‡ê²Œ ê´€ë¦¬ë˜ë‹¤ ë³´ë‹ˆ ë™ì¼í•œ ì—­í• ì„ í•˜ëŠ” í•¨ìˆ˜ê°€ 2~3ê°œì”© ì¡´ì¬í•˜ëŠ” ê²½ìš°ë„ ìˆì—ˆë‹¤ ğŸ˜…

```jsx
// EXAMPLE - GET /post/:id

// post.ts

// api íŒ¨ì¹­ í•¨ìˆ˜
const getPostDetail = async () => {
	return fetch(`/post/${:id}`)// API ìš”ì²­
}
// react-query hook
const useGetPostDetail = async (id) => {
	return useQuery(['post', id], () => getPostDetail(id));
}
```

### Query-key ê´€ë¦¬ì˜ ë¶€ì¬

Next.jsì—ì„œ SSRì„ ìœ„í•´ ì´ë¯¸ ì„œë²„ ë Œë”ë§ ë‹¨ê³„ì—ì„œ react-queryë¥¼ í†µí•´ ë°ì´í„°ë¥¼ íŒ¨ì¹­í•´ì„œ success ìƒíƒœì˜ ë°ì´í„°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì»´í¬ë„ŒíŠ¸ë¥¼ ê·¸ë ¤ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ë‹¬í•´ì¤€ë‹¤. í•˜ì§€ë§Œ, ì‹¤ì œ clientì—ëŠ” ì„œë²„ì—ì„œì˜ api íŒ¨ì¹­ ìƒíƒœê°€ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë‹¹ì—°í•˜ê²Œ hydration ì—ëŸ¬ê°€ ë°œìƒí•˜ê²Œ ëœë‹¤.

ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´, ì„œë²„ë‹¨ ì—ì„œ ì‚¬ìš©ëœ ìƒíƒœë“¤ì„ ë³´ê´€í•œ ReactQueryClientë¥¼ dehydrate í•¨ìˆ˜ë¥¼ ì´ìš©í•´ dehydrateí•´ì„œ ì „ë‹¬í•˜ê³ , í´ë¼ì´ì–¸íŠ¸ë‹¨ì—ì„œëŠ” ì „ë‹¬ë°›ì€ ìƒíƒœë¥¼ í´ë¼ì´ì–¸íŠ¸ë‹¨ ReactQueryClientì— ì ìš©í•˜ëŠ” ê²ƒìœ¼ë¡œ, ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•œë‹¤.

ì´ëŸ¬í•œ ê³¼ì •ì—ì„œ ìƒíƒœë¥¼ ë§¤ì¹­ì‹œí‚¤ëŠ” ê¸°ì¤€ì€ ë™ì¼í•œ query-keyê°€ ëœë‹¤. ë”°ë¼ì„œ query-keyë¥¼ ì¼ê´€ë˜ê²Œ ì‚¬ìš©í•´ì•¼ í•  í•„ìš”ê°€ ìˆëŠ” ê²ƒì´ë‹¤.

### API í•¨ìˆ˜ ê´€ë¦¬ì˜ ë¶€ì¬

ì´ ë˜í•œ, ìœ„ ë‘ ë¬¸ì œì˜ ì—°ì¥ì„ ì´ê¸°ë„ í–ˆë‹¤.

API í•¨ìˆ˜ê°€ ì—¬ëŸ¬ ê°œì˜ íŒŒë¼ë¯¸í„°ì™€ ì¿¼ë¦¬ë¥¼ ë°›ì„ ìˆ˜ ìˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³ , í•˜ë‚˜ì˜ ì¼ë§Œ ê°€ëŠ¥í•˜ê²Œ ì‘ì„±ëœ ê²½ìš°ê°€ ë§ì•˜ë‹¤. ê·¸ë¦¬ê³  ê·¸ëŸ¬í•œ í•¨ìˆ˜ê°€ í•˜ë‚˜ì˜ API ì—”ë“œí¬ì¸íŠ¸ì— 2~3ê°œ ì”© ì¡´ì¬í•˜ëŠ” ê²½ìš°ê°€ ìˆì—ˆë‹¤. ì´ëŸ¬í•œ ë¬¸ì œëŠ” ì•„ë¬´ë˜ë„ ì¼ì¢…ì˜ ì„ì‹œì ì¸ ê·œì¹™ì¸ API íŒ¨ì¹­ í•¨ìˆ˜ - react-query hookì„ ì§ì„ ì§“ëŠ” ê²ƒì— ìˆì—ˆë˜ ê²ƒ ê°™ë‹¤.

## ì •ë¦¬ ì‹œì‘

ì¼ë‹¨ ì •ë¦¬ë¥¼ ì‹œì‘í•¨ì— ìˆì–´ì„œ, í´ë”ë¥¼ queriesì™€ api ë¡œ ë‚˜ëˆ„ì—ˆë‹¤.

APIëŠ” ê³µìš©ìœ¼ë¡œ í”„ë¡œì íŠ¸ ìµœìƒìœ„ì— ì¡´ì¬í•˜ì§€ë§Œ, queriesëŠ” ì‚¬ìš© ë²”ìœ„ì— ë”°ë¼ ë‚˜ëˆ„ì—ˆë‹¤.

ë§Œì•½, ê³µìš©ìœ¼ë¡œ ì—¬ëŸ¬ í˜ì´ì§€ì—ì„œ ì‚¬ìš©ì´ ëœë‹¤ë©´ ìµœìƒìœ„ queriesì—, í•˜ë‚˜ì˜ í˜ì´ì§€ ë‚´ì—ì„œë§Œ ì‚¬ìš©ëœë‹¤ë©´ components/{page}/queries ì—ì„œ ì •ì˜í•˜ê¸°ë¡œ í–ˆë‹¤.

```jsx
src
- api // api íŒ¨ì¹­ í•¨ìˆ˜
- queries
	- index.ts // ì§­ react-query-kit í•¨ìˆ˜
	- {query-name} // ê³µìš© react-query
		- index.ts
- components
	- {page}
		- {queries} // {page} ë‚´ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì§­ react-query-kit í•¨ìˆ˜
			- index.ts
```

## React-Query ì •ë¦¬

React-Queryì™€ APIë¥¼ ì •ë¦¬í•˜ê¸° ìœ„í•´ react-query ë¬¸ì„œë¥¼ ë³´ë‹¤ê°€ react-query-kitì´ë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë°œê²¬í–ˆë‹¤. ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” react-query í›…ì„ í•œ ë²ˆ í•¨ìˆ˜ë¡œ ë˜í•‘í•œ ë‹¤ìŒ í”„ë¡œí¼í‹°ë¡œ query-keyì™€ query-fnì„ ë¶€ì—¬í•´, í˜„ì¬ ì‚¬ìš©í•˜ë ¤ëŠ” react-queryí•¨ìˆ˜ê°€ ì‚¬ìš©í•˜ëŠ” ë¶€ë¶„ ìš”ì†Œë“¤ì„ ì–´ë””ì„œë“  í˜¸ì¶œ í•  ìˆ˜ ìˆê²Œ ë§Œë“¤ì—ˆë‹¤.

ì•ˆê·¸ë˜ë„ ë¶ˆí¸í–ˆë˜ ëª¨ë“  ë¶€ë¶„ì´ í•´ì†Œë˜ëŠ” ì†”ë£¨ì…˜ì´ë¼ëŠ” ìƒê°ì´ ë“¤ì–´ ë‹¤ìŒê³¼ ê°™ì´ react-query-kitì˜ ë°©ì‹ì„ ê·¸ëŒ€ë¡œ ë”°ì˜¨ ê°„ë‹¨í•œ ì§­ react-query-kit í•¨ìˆ˜ë“¤ì„ ë§Œë“¤ì–´ì£¼ì—ˆë‹¤.

[like-react-query-kit](https://gist.github.com/dorage/bed30e84d75c872420baf35d0aeb39c0)

```tsx
import { PaginationAPIArguments } from 'api/typing/arguments';
import {
  MutationObserverOptions,
  useInfiniteQuery,
  UseInfiniteQueryOptions,
  useMutation,
  UseMutationOptions,
  useQuery,
  UseQueryOptions,
} from '@tanstack/react-query';

export type ReactQueryOptions = UseQueryOptions<any, unknown, any, any[]>;
export type ReactMutationOptions = Omit<MutationObserverOptions<unknown, unknown, any, unknown>, '_defaulted' | 'variables'>;
export type ReactInfiniteQueryOptions = UseInfiniteQueryOptions<any, unknown, any, any, any[]>;

type QueryKey<T> = string | object | ((args: T) => string | object);
type ResultQueryKey = (string | object)[];

const LazyQueryKey = <T>(keys: QueryKey<T>[], args: T): (string | object)[] =>
  keys.map((key) => {
    if (typeof key === 'string') return key;
    if (typeof key === 'function') return key(args);
    return key;
  });

/**
 * react-query-kit ì—ì„œ ì˜ê°ì„ ë°›ì•„ ë§Œë“  useQueryë¥¼ ìƒì„±í•´ì£¼ëŠ” íŒ©í† ë¦¬í•¨ìˆ˜ì…ë‹ˆë‹¤
 * 
 * ì•„ë˜ì™€ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤
 *
 * ```js
    // useQuery ìƒì„±
    const getCommentList = createQuery(['ffeed', (args) => args.ffeedId, 'comment'], getFFeedFFeedIdComment, {
      refetchOnMount: false,
      refetchOnReconnect: false,
      refetchOnWindowFocus: false,
    });
    // query key
    getCommentList.queryKey({ ffeedId: '123', page: 1 });
    // api fetch function
    getCommentList.queryFn({ ffeedId: '123', page: 1 });
 * ```
 *
 * @param queryKey
 * @param queryFn
 * @param options
 * @returns
 */
export const createUseQuery = <TQueryFnArgs, TQueryFnData>(
  queryKey: QueryKey<TQueryFnArgs>[],
  queryFn: (args: TQueryFnArgs) => Promise<TQueryFnData>,
  options: Omit<ReactQueryOptions, 'queryKey' | 'queryFn' | 'enabled'>
) => {
  const fn = (enabled: boolean, args: TQueryFnArgs) =>
    useQuery(LazyQueryKey<TQueryFnArgs>(queryKey, args), () => queryFn(args), { enabled, ...options });
  fn.queryKey = (args: TQueryFnArgs) => LazyQueryKey<TQueryFnArgs>(queryKey, args);
  fn.queryFn = queryFn;
  return fn;
};

export const createUseInfiniteQuery = <TQueryFnArgs, TQueryFnData>(
  queryKey: QueryKey<TQueryFnArgs>[],
  queryFn: (args: TQueryFnArgs & PaginationAPIArguments) => Promise<TQueryFnData>,
  options: Omit<ReactInfiniteQueryOptions, 'queryKey' | 'queryFn' | 'enabled'> & { pageSize: number }
) => {
  const fn = (enabled: boolean, args: TQueryFnArgs) =>
    useInfiniteQuery<TQueryFnData, unknown, TQueryFnData, ResultQueryKey>(
      LazyQueryKey<TQueryFnArgs>(queryKey, args),
      ({ pageParam = 1 }) => queryFn({ ...args, page: pageParam, pageSize: options.pageSize }),
      {
        enabled,
        ...options,
      }
    );
  fn.queryKey = (args: TQueryFnArgs) => LazyQueryKey<TQueryFnArgs>(queryKey, args);
  fn.queryFn = queryFn;
  return fn;
};

export const createUseMutation = <TQueryFnArgs, TQueryFnData>(queryFn: (args: TQueryFnArgs) => Promise<TQueryFnData>) => {
  const fn = (options: Omit<UseMutationOptions<TQueryFnData, unknown, TQueryFnArgs, unknown>, 'mutationFn'>) =>
    useMutation<TQueryFnData, unknown, TQueryFnArgs, unknown>(queryFn, options);
  fn.queryFn = queryFn;
  return fn;
};
```

ì§­ react-query-kit ì‚¬ìš©ì€ ë‹¤ìŒê³¼ ê°™ì´ í•˜ê²Œ ëœë‹¤.

```tsx
/**
 * ì»¤ë®¤ë‹ˆí‹°ê¸€ ê°€ì ¸ì˜¤ê¸°
 */
export const useGetPosts = createUseInfiniteQuery(['post', (args) => args], getPosts, {
  pageSize: 10,
  getNextPageParam: (lastPage) => {
		if (lastPage == null) return undefined;
    if (lastPage.count <= 10 * (lastPage.nextPage - 1)) {
      return undefined;
    } else {
      return lastPage.nextPage;
    }
  },
});

/**
 * ìœ ì €ê¸€ ì§€ì—­ë³„ í•„í„°ë§
 */
export const useGetPostLocation = createUseQuery(['post', 'location', (args) => args.searchWord], getPostLocation, {
  staleTime: 1000 * 60 * 5,
  cacheTime: 1000 * 60 * 5,
});
```

## API ì •ë¦¬

ë§ˆì§€ë§‰ìœ¼ë¡œ API í•¨ìˆ˜ë¥¼ ì •ë¦¬í•˜ê¸° ìœ„í•œ ê·œì¹™ì„ ì„¸ì› ë‹¤.

1. pathì˜ ì²« ë¦¬ì†ŒìŠ¤ë¥¼ ê¸°ì¤€ìœ¼ë¡œ íŒŒì¼ì„ ì‘ì„±í•œë‹¤
    
    ex) /post/:id â†’ post/index.ts
    
    ```jsx
    src
    	- api
    		- {pathname}
    			- index.ts // api
    			- typing
    				-index.ts // model typing
    ```
    
2. ì—”ë“œí¬ì¸íŠ¸ì˜ methodì™€ pathname ì„ í•¨ìˆ˜ ëª…ìœ¼ë¡œ í•œë‹¤.
    
    ex) GET /post â†’ getPost()
    
3. apiëŠ” swagger ìƒ ìˆœì„œëŒ€ë¡œ ì •ë¦¬í•œë‹¤
4. ì£¼ì„ì€ swaggerìƒì˜ ì„¤ëª…ê³¼ ë™ì¼í•´ì•¼ í•œë‹¤.
5. í•˜ë‚˜ì˜ í•¨ìˆ˜ê°€ í•˜ë‚˜ì˜ APIì—”ë“œí¬ì¸íŠ¸ì™€ ì™„ë²½í•˜ê²Œ ëŒ€ì‘í•œë‹¤. (ëª¨ë“  ì¿¼ë¦¬ì™€ íŒŒë¼ë¯¸í„°ë¥¼ ê°–ëŠ”ë‹¤)

ë˜í•œ, ë„¤ì´ë°ì€ {method}{pathname} ìœ¼ë¡œ êµ¬ì„±í–ˆë‹¤.

```jsx
/** ------------------------------------------------------------------------------
 * 
 * ì»¤ë®¤ë‹ˆí‹° ë¦¬ìŠ¤íŠ¸ arguments type
 * 
 ------------------------------------------------------------------------------ */
interface getPostArguments {
  type: '' | 'community' | 'sell';
  writerId?: null;
  locationIds?: any[];
  specId?: string;
  follower?: boolean;
}
interface getPostResponse extends PaginationAPIResponse {
  ffeeds: (CommunityMoodboardModel | CommunitySellModel | CommunityPremiumModel)[];
}
/** ------------------------------------------------------------------------------
 * 
 * ì»¤ë®¤ë‹ˆí‹° ë¦¬ìŠ¤íŠ¸
 * 
 * **method**: GET
 * 
 * **pathname** : /post?${queryString}
 * 
 ------------------------------------------------------------------------------ */
export const getPost = async (props: getPostArguments & PaginationAPIArguments): Promise<getPostResponse> => {
  const queryString = QueryString.stringify(props, QS_STRINGIFY_OPTIONS);

  const { data } = await clientAxios({
    method: METHOD.GET,
    url: `/post?${queryString}`,
  });

  return data;
};
```

## ë§ˆë¬´ë¦¬

ì‚¬ì‹¤ ì´ëŸ¬í•œ ì¼ë“¤ì€ ì„œë¹„ìŠ¤ê°€ ì–´ëŠ ì •ë„ ê¶¤ë„ì— ì˜¤ë¥¸ ë’¤ë¶€í„° ì‹œì‘ í•˜ëŠ” ê²ƒì´ ë§ë‹¤ê³ ëŠ” ìƒê°í•œë‹¤.

í•˜ì§€ë§Œ, ê°€ì„¤ì´ ì„±ë¦½ë˜ì—ˆë‹¤ê³  ê°€ì •í•˜ê³  ì‹œì‘í•œ ì„œë¹„ìŠ¤ì— ìˆ˜ë§ì€ ë¶€ê°€ ì„œë¹„ìŠ¤ë“¤ì´ ê³„ì† ì¶”ê°€ ë˜ë‹¤ ë³´ë‹ˆ, í•˜ë‚˜ì˜ ê¸°ëŠ¥ ìˆ˜ì •ì— ë„ˆë¬´ ë§ì€ ë¬¸ì œê°€ ìˆë‹¤ëŠ” ìƒê°ì´ ë“¤ì–´ ì–´ëŠ ì •ë„ ì •ë¦¬ë¥¼ í•˜ëŠ” ê²ƒì´ ë§ë‹¤ëŠ” ìƒê°ì´ ë“¤ì–´ ì‹œì‘í•˜ê²Œ ë˜ì—ˆë‹¤.